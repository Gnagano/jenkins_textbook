---
- name: mysql / install packages
  apt:
    name: "{{ item }}"
    state: present
  with_items: "{{ mysql_basic_packages }}"

- name: mysql / create database
  mysql_db:
    name: "{{ mysql_database }}"
    state: present

- name: mysql / create user
  mysql_user:
    name: "{{ mysql_user }}"
    host: "{{ mysql_host }}"
    password: "{{ mysql_password }}"
    priv: "{{ mysql_database }}.*:ALL"

- command: mysql -NBe "SELECT COUNT(*) FROM mysql.time_zone"
  register: mysql_timezones_count
  changed_when: false
  check_mode: no

- name: ensure timezone data is imported
  shell: "mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql mysql"
  when: mysql_timezones_count.stdout|int < 1
  notify: restart mysql
